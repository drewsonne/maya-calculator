<!doctype html>
<html lang="en">
<head>
    <title>Maya Calculator</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.js" type="text/javascript"></script>
    <script src="js/luxon.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">


    <script src="js/bundle.js" type="text/javascript"></script>
    <link href="css/app.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <span class="navbar-brand mb-0 h1">
        <img src="ajaw.png" width="30" height="30"
             class="d-inline-block align-top" alt="Maya Calculator">
        Maya Calculator
    </span>
</nav>
<div class="container-fluid">
    <div class="row monospace">
        <textarea class="col-4" id="calendar_input" rows="25"></textarea>
        <table id="longcount_output" class="col-8"></table>
    </div>
</div>
<script src="js/bootstrap.js" type="text/javascript"></script>

<script type="application/javascript">
  $(document).ready(function () {

    const calculator = new MayaCalculator()
    let input = $('#calendar_input')
    let output = $('#longcount_output')
    let evaluate = function (raw_calculations) {
      let results = calculator.evaluate(raw_calculations)

      output.html($.merge(
        $(`<tr>
                <th>C. Round</th>
                <th>Pos.</th>
                <th>Long Count</th>
                <th>Night</th>
                <th class="left_align">Annotation</th>
            </tr>`),
        results,
      ))

      $('tr.data-row').each(function (index, element) {
        if (index % 2 === 0) {
          $(element).addClass('odd_row')
        }
      })
    }

    let saved_calculation_raw = window.location.hash.replace('#', '')
    if (saved_calculation_raw.length > 0) {
      let saved_calculation = atob(saved_calculation_raw)
      input.html(saved_calculation)
      evaluate(saved_calculation)
    }

    let run_event
    input.keyup(function (event) {
      clearTimeout(run_event)
      run_event = setInterval(function () {
        let raw_calculations = input.val().trim()
        evaluate(raw_calculations)
        window.location.hash = '#' + btoa(raw_calculations)
      }, 500)
    })
  })


</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async
        src="https://www.googletagmanager.com/gtag/js?id=UA-33704557-2"></script>
<script>
  window.dataLayer = window.dataLayer || []

  function gtag () {dataLayer.push(arguments)}

  gtag('js', new Date())

  gtag('config', 'UA-33704557-2')
</script>
</body>

</html>
